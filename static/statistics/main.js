// Generated by CoffeeScript 1.4.0
var ajax=(function($){

  function started(){
    $("#leido").on("click", function(){
      $("#myModal").modal("show");
      $.ajax({
          async:true,
              url: '/InBox/',
              type: 'POST',
              success: function(response) {
                if (response.exito) {
                  $("#leido").html('<img src="/static/base/img/inbox-5-24.ico"/>0 Notificaciones');
                  console.log("exito");
                }
              },
        });
    });

    var socket = io.connect("http://10.17.1.200:3000");

    var map = L.map('mimapa', {
        center: [24.803253, -107.389812],
        zoom: 12,
    });

    var tiles = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');

    map.addLayer(tiles);

    map.locate({
      enableHighAccuracy: true
    });

    map.on('locationfound', onLocationFound);

    socket.on('coords:user', onReceiveData);

    function onLocationFound(position) {
      console.log(position.latlng);
      var mycoords = position.latlng;
      var marker = L.marker([mycoords.lat, mycoords.lng]);

      map.addLayer(marker);
      marker.bindPopup('Estás aquí');

      socket.emit('coords:me', {latlng: mycoords});
    }

    function onReceiveData(data) {
      console.log(data);
      var coordsUser = data.latlng;
      var marker = L.marker([coordsUser.lat, coordsUser.lng]);

      map.addLayer(marker);
      marker.bindPopup('Estás aquí');
    }
  }





  return{
    inicio:started
  }

})(jQuery);

$(document).on('ready', ajax.inicio );