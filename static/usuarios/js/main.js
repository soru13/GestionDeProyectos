// Generated by CoffeeScript 1.4.0
var ajax=(function($){
  function FullDate(){
    $("#detalles").dialog({
                modal: true,
                //width: 910,
                //minWidth: 300,
                //maxWidth: 300,
                title:"Detalles",
                //height:600,
                show: "fold",
                hide: "slow",
                resizable: false,
      });
  }
  return{
    mostrar: FullDate
  }

})(jQuery);
  $(document).on('ready', inicio );
  function inicio(){
    $("#leido").on("click", function(){
      $("#myModal").modal("show");
      $.ajax({
          async:true,
              url: '/InBox/',
              type: 'POST',
              success: function(response) {
                if (response.exito) {
                  $("#leido").html('<img src="/static/base/img/inbox-5-24.ico"/>0 Notificaciones');
                  console.log("exito");
                }
              },
        });
    });

    $("#allformulario").show();
    $("#formulario").get(0).reset();
      $('#formulario').bind('submit', function(e) {
      e.preventDefault();
      var accion = $('#formulario').find('input[type=submit]').val();
      console.log(accion);
      var url = accion == 'Agregar' ? '/NuevoUsuarioAjax/':'/EditarUsuarioAjax/';
      var fd = new FormData($('#formulario').get(0));
      if (accion == 'Terminar') {
        var id_usuario = location.href.substr(location.href.lastIndexOf('/')+1);
        fd.append('id_usuario', id_usuario);
      }
      $('#exito').attr({'title':'Usuarios','href':'/Usuarios'});
      $.ajax({
        url: url,
        data: fd,
        type: 'POST',
        success: function(data) {
          if (data.exito) {
            $("#resultados").html("<span class='alert alert-success'>Creado Exitosamente</span>");
            if (accion == 'Agregar') {
              $("#formulario").get(0).reset();
              $("#exito").show();
            };
            if (accion == 'Terminar') {
              $("#exito").show();
            }
          } else {
            $("#resultados").html('');
            if (data.errores.username) {
              $('<span class="alert alert-error"><b>Usuario </b>' + data.errores.username + '</span>').appendTo('#resultados');
            }
            if (data.errores.Usuario) {
              $('<span class="alert alert-error"><b>Usuario </b>' + data.errores.Usuario + '</span>').appendTo('#resultados');
            }
            if (data.errores.password1) {
              $('<span class="alert alert-error"><b>password1 </b>' + data.errores.password1 + '</span>').appendTo('#resultados');
            }
            if (data.errores.password2) {
              $('<span class="alert alert-error"><b>password2 </b>' + data.errores.password2 + '</span>').appendTo('#resultados');
            }
          }
        },
        processData: false,
        contentType: false
      });
    });
  };
